<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <!--
        Exclude EI_EXPOSE_REP* warnings for Lombok-generated code.
        Spring beans are immutable by contract after dependency injection,
        and defensive copying would be unnecessary overhead.
    -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2" />
        <Class name="~me\.golemcore\.bot\..*" />
    </Match>

    <!-- But keep EI_EXPOSE_REP for public API models that users interact with -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP,EI_EXPOSE_REP2" />
        <Not>
            <Or>
                <Class name="~me\.golemcore\.bot\.domain\.model\..*" />
                <Class name="~me\.golemcore\.bot\.port\..*" />
            </Or>
        </Not>
    </Match>
    <!--
        Broad catch(Exception) is intentional in pipeline systems to prevent
        one system's failure from crashing the entire agent loop.
        RuntimeConfigService.persist() catches multiple checked exceptions
        (JsonProcessingException, CompletionException) from JSON/storage ops.
    -->
    <Match>
        <Bug pattern="REC_CATCH_EXCEPTION" />
        <Or>
            <Class name="~me\.golemcore\.bot\.domain\.system\..*" />
            <Class name="me.golemcore.bot.domain.service.PlanExecutionService" />
            <Class name="me.golemcore.bot.domain.service.RuntimeConfigService" />
        </Or>
    </Match>
    <!--
        Returning null from getObject() is intentional — null means "file not found".
        Callers (getText, etc.) depend on this null semantic to distinguish
        missing files from empty files.
    -->
    <Match>
        <Bug pattern="PZLA_PREFER_ZERO_LENGTH_ARRAYS" />
        <Class name="me.golemcore.bot.adapter.outbound.storage.LocalStorageAdapter" />
    </Match>
    <!--
        ElevenLabsAdapter.isQuotaExceededMessage() uses toLowerCase() without Locale.
        This is intentional — matching English error messages from the API, not user text.
    -->
    <Match>
        <Bug pattern="DM_CONVERT_CASE" />
        <Class name="me.golemcore.bot.adapter.outbound.voice.ElevenLabsAdapter" />
    </Match>
    <!--
        Response.body() null checks are defensive.
        While OkHttp 5.x marks body() as non-null, it can still return null
        for empty responses (204 No Content, etc.). Keep defensive checks.
    -->
    <Match>
        <Bug pattern="RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE" />
        <Or>
            <Class name="me.golemcore.bot.adapter.outbound.voice.ElevenLabsAdapter" />
            <Class name="me.golemcore.bot.adapter.outbound.rag.LightRagAdapter" />
        </Or>
    </Match>
    <!--
        Adapters, systems, and tools intentionally wrap checked exceptions as
        RuntimeException because port interfaces don't declare checked exceptions.
        This is a standard adapter-layer pattern in hexagonal architecture.
    -->
    <Match>
        <Bug pattern="THROWS_METHOD_THROWS_RUNTIMEEXCEPTION" />
        <Or>
            <Class name="~me\.golemcore\.bot\.adapter\..*" />
            <Class name="~me\.golemcore\.bot\.domain\.system\..*" />
        </Or>
    </Match>
    <!--
        Methods that declare 'throws Exception' due to framework callback interfaces
        (OkHttp Callback, TelegramBots LongPollingBot, MCP lifecycle, etc.)
        or catch-all error handling in pipeline systems.
    -->
    <Match>
        <Bug pattern="THROWS_METHOD_THROWS_CLAUSE_BASIC_EXCEPTION" />
        <Or>
            <Class name="~me\.golemcore\.bot\.adapter\..*" />
            <Class name="~me\.golemcore\.bot\.domain\.system\..*" />
            <Class name="~me\.golemcore\.bot\.tools\..*" />
        </Or>
    </Match>

    <!--
        Protobuf Java classes are generated code. SpotBugs findings in generated
        messages/builders are not actionable in this repository.
    -->
    <Match>
        <Class name="~me\.golemcore\.bot\.adapter\.inbound\.web\.proto\..*" />
    </Match>
    <Match>
        <Class name="~me\.golemcore\.bot\.proto\.session\.v1\..*" />
    </Match>
</FindBugsFilter>
